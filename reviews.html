<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>í›„ê¸° ê²Œì‹œíŒ | Maple FastBuy</title>
  <meta name="description" content="ë©”ì´í”ŒìŠ¤í† ë¦¬ ê¸‰ì²˜í…œ êµ¬ë§¤ í›„ê¸° ê²Œì‹œíŒ">
  <!-- ê¸°ì¡´ ì „ì—­ CSSê°€ ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ë‘ì„¸ìš” -->
  <link rel="stylesheet" href="styles.css"/>

  <!-- âœ… í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼(ë‹¤ë¥¸ í˜ì´ì§€ì™€ ì¶©ëŒ ë°©ì§€: .reviews-page ë„¤ì„ìŠ¤í˜ì´ìŠ¤) -->
  <style>
    .reviews-page { max-width: 920px; margin: 40px auto; padding: 0 16px; font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif; }
    .reviews-page .header { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; }
    .reviews-page .h1 { font-size: 24px; font-weight: 800; margin:0; }
    .reviews-page .sub { color:#666; margin:6px 0 10px; }
    .reviews-page .stats { display:flex; gap:10px; align-items:center; color:#555; margin: 6px 0 16px; font-size:14px; }
    .reviews-page .chip { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid #e6e6e6; border-radius:999px; background:#fafafa; }
    .reviews-page .chip.green { border-color:#bee2c3; background:#f4fff7; color:#0a7; }
    .reviews-page .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:16px; }
    .reviews-page .row { display:flex; gap:12px; flex-wrap:wrap; }
    .reviews-page .row > * { flex:1; min-width: 200px; }
    .reviews-page label { display:block; font-size:12px; color:#666; margin-bottom:6px; }
    .reviews-page input, .reviews-page select, .reviews-page textarea {
      width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; font-size:14px; outline:none;
    }
    .reviews-page input:focus, .reviews-page select:focus, .reviews-page textarea:focus { border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,.15); }
    .reviews-page button.btn { padding:10px 14px; border:0; border-radius:10px; background:#2563eb; color:#fff; cursor:pointer; font-weight:600; }
    .reviews-page button.btn.ghost { background:#f3f5f9; color:#333; }
    .reviews-page button.btn.danger { background:#fff; color:#e11d48; border:1px solid #fecdd3; }
    .reviews-page .hint { font-size:12px; color:#888; margin-top:6px; }
    .reviews-page .divider { height:1px; background:#eee; margin:18px 0; }
    .reviews-page .review { border:1px solid #eee; border-radius:12px; padding:14px; background:#fff; }
    .reviews-page .list { display:grid; gap:12px; }
    .reviews-page .name { font-weight:700; }
    .reviews-page .meta { color:#666; font-weight:400; font-size:13px; margin-left:8px; }
    .reviews-page .content { margin-top:8px; white-space:pre-wrap; line-height:1.6; }
    .reviews-page .del { float:right; margin-left:8px; border:1px solid #fca5a5; color:#b91c1c; background:#fff; padding:4px 8px; border-radius:8px; cursor:pointer; }
    .reviews-page .toolbar { display:none; gap:8px; }
    .reviews-page .toolbar.show { display:flex; }
    .reviews-page .footer { margin:26px 0 12px; text-align:center; color:#777; font-size:13px; }
    .reviews-page .kbd { display:inline-block; border:1px solid #e6e6e6; background:#fafafa; padding:2px 6px; border-radius:6px; color:#666; font-family:ui-monospace,monospace; font-size:12px; }
    .reviews-page .toast {
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
      padding:10px 14px; border-radius:10px; background:#0f172a; color:#fff; border:1px solid #334155;
      box-shadow:0 8px 24px rgba(0,0,0,.25); opacity:0; pointer-events:none; transition:.25s;
    }
    .reviews-page .toast.show { opacity:1; }
  </style>
</head>
<body>
  <div class="reviews-page">
    <div class="header">
      <div>
        <div class="h1">ê³ ê° í›„ê¸°</div>
        <div class="sub">ì‹¤ê±°ë˜ ê¸°ë°˜ í›„ê¸°ì…ë‹ˆë‹¤. ê´‘ê³ /ì•…ì„± ê¸€ì€ ê´€ë¦¬ìì— ì˜í•´ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        <div class="stats">
          <span class="chip"><strong>í‰ê· </strong> <span id="avgRating" style="margin-left:6px">-</span></span>
          <span class="chip"><strong>ì´ í›„ê¸°</strong> <span id="countRating" style="margin-left:6px">0ê±´</span></span>
          <span id="adminState" class="chip green" style="display:none">ê´€ë¦¬ì ëª¨ë“œ</span>
        </div>
      </div>
      <div class="toolbar" id="adminToolbar">
        <button class="btn ghost" id="btnExport">ë°±ì—…</button>
        <button class="btn ghost" id="btnImport">ë³µì›</button>
        <button class="btn danger" id="btnClear">ì „ì²´ ì‚­ì œ</button>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <form id="reviewForm">
        <div class="row">
          <div>
            <label for="name">ë‹‰ë„¤ì„</label>
            <input id="name" name="name" maxlength="20" placeholder="ë‹‰ë„¤ì„"/>
          </div>
          <div>
            <label for="rating">í‰ì </label>
            <select id="rating" name="rating">
              <option value="5">â˜…â˜…â˜…â˜…â˜… (5)</option>
              <option value="4">â˜…â˜…â˜…â˜…â˜† (4)</option>
              <option value="3">â˜…â˜…â˜…â˜†â˜† (3)</option>
              <option value="2">â˜…â˜…â˜†â˜†â˜† (2)</option>
              <option value="1">â˜…â˜†â˜†â˜†â˜† (1)</option>
            </select>
          </div>
        </div>
        <div style="margin-top:10px;">
          <label for="content">í›„ê¸° ë‚´ìš©</label>
          <textarea id="content" name="content" rows="4" maxlength="1000" placeholder="ë§¤ë„ˆ/ì†ë„/ê°€ê²© ë“± êµ¬ì²´ì ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”. (ìµœëŒ€ 1000ì)"></textarea>
          <div class="hint" style="margin-top:6px">
            ê´€ë¦¬ì ëª¨ë“œ: í‚¤ë³´ë“œë¡œ <span class="kbd">8246</span> ì…ë ¥ â†’ ì‚­ì œ ë²„íŠ¼ ë³´ì„ Â·
            í† ê¸€: <span class="kbd">Ctrl</span>+<span class="kbd">Alt</span>+<span class="kbd">A</span>
          </div>
        </div>
        <div class="row" style="margin-top:10px; align-items:center;">
          <div style="flex:0;">
            <button class="btn" type="submit">í›„ê¸° ë“±ë¡</button>
          </div>
          <div id="formMsg" style="color:#2563eb;"></div>
        </div>
      </form>
    </div>

    <div class="divider"></div>

    <div class="list" id="reviews"></div>

    <div class="footer">Â© <span id="year"></span> Maple FastBuy Â· ì´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ì€ ë‹¤ë¥¸ í˜ì´ì§€ì™€ ê²¹ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <input type="file" id="fileInput" accept="application/json" style="display:none"/>

  <!-- âœ… í˜ì´ì§€ ì „ìš© ìŠ¤í¬ë¦½íŠ¸(ë‹¤ë¥¸ í˜ì´ì§€ì™€ ì¶©ëŒ ì—†ìŒ) -->
  <script>
    (function(){
      const STORAGE_KEY = 'mf_reviews_v3'; // ìƒˆë¡œìš´ í‚¤ë¡œ ë¶„ë¦¬ (ê¸°ì¡´ ë°ì´í„°ì™€ ì¶©ëŒ ë°©ì§€)
      const ADMIN_PIN = '8246';

      // ìœ í‹¸
      const $ = (sel)=>document.querySelector(sel);
      const yearEl = $('#year'); if (yearEl) yearEl.textContent = new Date().getFullYear();
      const toastEl = $('#toast');
      const toast = (msg)=>{ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 1600); };
      const escapeHtml = (s)=>(s||'').toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
      const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
      const stars = (n)=>{ const r=clamp(parseInt(n||5,10),1,5); return 'â˜…'.repeat(r)+'â˜†'.repeat(5-r); };
      const uid = ()=>Math.random().toString(36).slice(2,10)+Date.now().toString(36).slice(-6);

      // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
      const load = ()=>{ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}catch{return[]} };
      const save = (arr)=>localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));

      // DOM
      let admin = false;
      const form = $('#reviewForm');
      const listEl = $('#reviews');
      const formMsg = $('#formMsg');
      const avgEl = $('#avgRating');
      const cntEl = $('#countRating');
      const adminState = $('#adminState');
      const adminToolbar = $('#adminToolbar');
      const fileInput = $('#fileInput');

      function render(){
        const items = load().sort((a,b)=>new Date(b.ts)-new Date(a.ts));
        cntEl && (cntEl.textContent = items.length + 'ê±´');

        if (!items.length){
          listEl.innerHTML = '<div class="card" style="text-align:center;color:#666;">ì•„ì§ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”! ğŸ‰</div>';
          avgEl && (avgEl.textContent = '-');
        }else{
          const avg = items.reduce((s,r)=>s+(Number(r.rating)||0),0)/items.length;
          avgEl && (avgEl.textContent = \`\${stars(Math.round(avg))} (\${avg.toFixed(1)})\`);

          listEl.innerHTML = '';
          items.forEach(r=>{
            const dt = new Date(r.ts);
            const dateStr = \`\${dt.getFullYear()}.\${String(dt.getMonth()+1).padStart(2,'0')}.\${String(dt.getDate()).padStart(2,'0')}\`;
            const div = document.createElement('div');
            div.className = 'review';
            div.innerHTML = \`
              <div class="name">\${escapeHtml(r.name||'ìµëª…')}
                <span class="meta">Â· \${stars(r.rating)} Â· \${dateStr}</span>
                \${admin ? '<button class="del" data-id="'+escapeHtml(r.id)+'">ì‚­ì œ</button>' : ''}
              </div>
              <div class="content">\${escapeHtml(r.content||'')}</div>
            \`;
            listEl.appendChild(div);
          });

          if (admin){
            listEl.querySelectorAll('button.del').forEach(btn=>{
              btn.addEventListener('click', ()=>{
                const id = btn.getAttribute('data-id');
                const now = load();
                const target = now.find(x=>x.id===id);
                if (!target){ toast('ì´ë¯¸ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
                if (!confirm('ì´ í›„ê¸°ë¥¼ ì‚­ì œí• ê¹Œìš”?\\n\\n\"'+target.content.slice(0,50)+(target.content.length>50?'â€¦':'')+'\"')) return;
                save(now.filter(x=>x.id!==id)); // âœ… ê°œë³„ ì‚­ì œ
                render();
                toast('í›„ê¸° 1ê±´ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.');
              });
            });
          }
        }

        adminState.style.display = admin ? 'inline-flex' : 'none';
        adminToolbar.classList.toggle('show', admin);
      }

      // ì œì¶œ
      if (form){
        form.addEventListener('submit', (e)=>{
          e.preventDefault();
          formMsg && (formMsg.textContent = '');

          const name = ($('#name').value||'').trim().slice(0,20) || 'ìµëª…';
          const rating = clamp(parseInt($('#rating').value,10)||5,1,5);
          const content = ($('#content').value||'').trim().slice(0,1000);

          if (!content){
            formMsg ? (formMsg.textContent='í›„ê¸°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.') : toast('í›„ê¸°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
          }
          const entry = { id: uid(), name, rating, content, ts: new Date().toISOString() };
          save([entry, ...load()]);
          form.reset();
          formMsg && (formMsg.textContent='ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!'); setTimeout(()=>formMsg.textContent='', 1500);
          render();
          toast('í›„ê¸° ë“±ë¡ ì™„ë£Œ');
        });
      }

      // ê´€ë¦¬ì ëª¨ë“œ (ìˆ«ì 8246 ì…ë ¥ â†’ PIN í™•ì¸ â†’ í† ê¸€ Ctrl+Alt+A)
      let seq = [];
      window.addEventListener('keydown', (e)=>{
        seq.push(e.key);
        if (seq.slice(-4).join('') === ADMIN_PIN){
          const pin = prompt('ê´€ë¦¬ì PINì„ ì…ë ¥í•˜ì„¸ìš”:');
          if (pin === ADMIN_PIN){ admin = true; toast('ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”'); render(); }
          else { toast('PINì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
          seq = [];
        }
      });
      window.addEventListener('keydown', (e)=>{
        if (e.ctrlKey && e.altKey && e.key.toLowerCase()==='a'){
          const pin = prompt('ê´€ë¦¬ì PINì„ ì…ë ¥í•˜ì„¸ìš”:');
          if (pin === ADMIN_PIN){ admin = !admin; toast(admin?'ê´€ë¦¬ì ëª¨ë“œ ON':'ê´€ë¦¬ì ëª¨ë“œ OFF'); render(); }
        }
      });

      // ê´€ë¦¬ì íˆ´ë°”: ì „ì²´ ì‚­ì œ/ë°±ì—…/ë³µì›
      $('#btnClear')?.addEventListener('click', ()=>{
        if (!admin) return;
        if (confirm('ì •ë§ ëª¨ë“  í›„ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')){
          localStorage.setItem(STORAGE_KEY, '[]');
          render();
          toast('ëª¨ë“  í›„ê¸°ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.');
        }
      });
      $('#btnExport')?.addEventListener('click', ()=>{
        if (!admin) return;
        const data = JSON.stringify(load(), null, 2);
        const blob = new Blob([data], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'reviews-backup.json';
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        toast('ë°±ì—… íŒŒì¼ì„ ë‚´ë ¤ë°›ì•˜ìŠµë‹ˆë‹¤.');
      });
      $('#btnImport')?.addEventListener('click', ()=>{ if (admin) $('#fileInput').click(); });
      $('#fileInput')?.addEventListener('change', (e)=>{
        const f = e.target.files?.[0]; if (!f) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          try{
            const parsed = JSON.parse(String(reader.result||'[]'));
            if (!Array.isArray(parsed)) throw new Error('í˜•ì‹ ì˜¤ë¥˜');
            const norm = parsed.map(r=>({
              id: r.id || uid(),
              name: String(r.name||'ìµëª…').slice(0,20),
              rating: clamp(parseInt(r.rating,10)||5,1,5),
              content: String(r.content||'').slice(0,1000),
              ts: r.ts || new Date().toISOString()
            }));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(norm));
            render(); toast('ë³µì› ì™„ë£Œ');
          }catch(err){ toast('ë³µì› ì‹¤íŒ¨: ì˜¬ë°”ë¥¸ JSON íŒŒì¼ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.'); }
        };
        reader.readAsText(f);
      });

      // init
      render();
    })();
  </script>
</body>
</html>
